name: Build and Test

on:
  push

jobs:
    build:
        name: Build and Test Qt${{ matrix.qt_ver }}
        runs-on: ubuntu-latest
        strategy:
          fail-fast: false
          matrix:
              qt_ver: [6.6.0]
        steps:
          - name: Install Qt
            uses: jurplel/install-qt-action@v2
            with:
              version: ${{ matrix.qt_ver }}
          - name: Git Checkout
            uses: actions/checkout@v2
          - name: Create Build Directory
            shell: pwsh
            run: |
              mkdir build
              cd build
          - name: Install Linux Dependencies
            run: |
              sudo apt-get update -y
              sudo apt-get install libxcb-icccm4 libxcb-xkb1 libxcb-icccm4 libxcb-image0 libxcb-render-util0 libxcb-randr0 libxcb-keysyms1 libxcb-xinerama0 libxcb-xinput-dev
          - name: Build
            shell: pwsh
            run: |
              cd build
              qmake -makefile ../
              make
          - name: Test
            id: runtests
            uses: GabrielBB/xvfb-action@v1
            with:
              working-directory: ./build
              run: cmake --build . --target test
